<!DOCTYPE html>
<html lang="it">
  <head>
    <title>Gestione Dati - The Bocchette 2</title>
    <!-- START <meta> -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- END <meta> -->

    <!-- Content -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
    <script src="/var.js"></script>
  </head>
  <body style="font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande','Lucida Sans', Arial, sans-serif; background-color: #195e79ad; margin-left: 20px; cursor: default;">
    <div style="display: flex; flex-direction: row; justify-content: flex-start;">
      <a href="/game/home.html" style="text-decoration: none; font-size: 25px; border: solid 2px black;" title="Indietro">⬅️</a>
    </div>
    <h2 style="margin-block-start: 0.2em;">Gestione Dati</h2>
    
    <div style="margin-top: 0px;">
      <hx>Salva</hx>
      <li>
        <button disabled title="Questo è un account Ospite">Salva sul server</button> Server:
        <select>
          <option value="Express 1">Express.js - 1</option>
          <option value="Node 1" disabled>OneDrive</option>
        </select>
      </li>

      <li>
        <button style="background: dodgerblue; border-style: double; border-radius: 6px; color: white; cursor: pointer;" onclick="scar('soldi = '+soldi+'; gemme = '+gemme+'; obbiettivo (pass) = '+obb+';; PassPremium = '+passP+'; gettoni(pass) = '+gett+'; TecnicheUnlock = '+tecnicUnlock+'; TecnicUnlockCom = '+tecnicLockCom);">Salva sul tuo PC</button>
      </li>
    </div>

    <div style="margin-top: 20px;">
      <hx>Carica</hx>
      <li><button onclick="" style="background: dodgerblue; border-style: double; border-radius: 6px; color: white; cursor: pointer;">
        <input id="file-upload" type="file" accept=".encrypt" hidden>
        <label for="file-upload" style="cursor: pointer;">Carica un salvataggio dal PC</label>
      </button></li>
      <li><button disabled>Carica un salvataggio dal Server</button> Server:
        <select>
          <option value="Express 1">Express.js - 1</option>
          <option value="OneDrive" disabled>OneDrive</option>
        </select>
      </li> 
    </div>


  </body>
</html>

<script>/*
const now = new Date();
const date = now.toLocaleDateString();

function getCurrentDateTime() {
  const time = now.toLocaleTimeString();
  return date + ' ' + time;
}

function createFileContent(text) {
  const dateTime = getCurrentDateTime();
  const fileContent = dateTime + '\n\n' + text;
  return fileContent;
}

function encryptText(text, key) {
  const encryptedText = CryptoJS.AES.encrypt(text, key).toString();
  return encryptedText;
}

function downloadFile(text) {
  const encryptedText = encryptText(text);
  const fileContent = createFileContent(encryptedText);
  const fileBlob = new Blob([fileContent], { type: 'text/plain' });
  const fileURL = URL.createObjectURL(fileBlob);
  const fileName = 'Salvataggio del ' + date + '.encrypt';

  const link = document.createElement('a');
  link.href = fileURL;
  link.download = fileName;
  link.click();
}

function decryptAndReadFile(file) {
  const reader = new FileReader();
  reader.onload = function(event) {
    const fileContent = event.target.result;
    const lines = fileContent.split('\n');
    const fileDateTime = lines[0];
    const fileDate = fileDateTime.split(' ')[0];

    if (fileDate === date) {
      const encryptedText = lines.slice(2).join('\n');
      const decryptedText = atob(encryptedText);
      alert(decryptedText);
    } else {
      alert('I 2 file non coincidono!');
      window.location.href = '/game/menu/GestDat.html';
    }
  };
  reader.readAsText(file);
}

function handleFileSelect(event) {
  const file = event.target.files[0];
  const fileName = file.name;
  if (!fileName.endsWith('.encrypt')) {
    alert('Selezionare un file .encrypt');
    return;
  }
  decryptAndReadFile(file);
}

function scar(text) {
  downloadFile(text);
}

const fileInput = document.querySelector('input[type="file"]');
fileInput.addEventListener('change', handleFileSelect);
*/
</script>

<script>
  function scar(text) {
    const encryptedText = btoa(text);
    const fileName = 'file.encrypt';

    const downloadLink = document.createElement('a');
    downloadLink.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(encryptedText);
    downloadLink.download = fileName;

    document.body.appendChild(downloadLink);
    downloadLink.click();
    document.body.removeChild(downloadLink);
  }



  function decryptFile(file) {
  const reader = new FileReader();
  reader.onload = function(event) {
    const encryptedText = event.target.result;
    const decryptedText = atob(encryptedText);

    // Fai qualcosa con il testo decriptato
    console.log(decryptedText);
    window.alert('Dati decriptati: ' + decryptedText);
  };

  reader.readAsText(file);
}

function handleFileSelect(event) {
  const file = event.target.files[0];
  const fileName = file.name;

  if (!fileName.endsWith('.encrypt')) {
    alert('Si prega di selezionare un file .encrypt');
    return;
  }

  // Azzera il valore del campo di input file
  this.value = null;

  decryptFile(file);
}

const fileInput = document.getElementById('file-upload');
const label = document.querySelector('label[for="file-upload"]');
const button = label.parentElement;

button.addEventListener('mousedown', function(event) {
  event.stopPropagation(); // Ferma la propagazione dell'evento

  const confirmResult = window.confirm('I dati che caricherai dal PC sostituiranno i progressi attuali; continuare?');
  if (!confirmResult) {
    event.preventDefault(); // Ferma l'azione predefinita dell'evento
    return;
  }

  // Apre il campo di input file
  fileInput.click();
});

fileInput.addEventListener('change', handleFileSelect);
</script>